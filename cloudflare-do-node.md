# Cloudflare Durable Objects (耐久オブジェクト) メモ

永続ストレージ付きの特殊な Worker がオンデマンドでエッジにデプロイされて、
しばらく使われないとシャットダウンする仕掛けらしい。

## KV, Durable Objects, D1 and R2 の比較表

| サービス名      | 主な特徴                                                                                                                                                                                                                                                        | 向いている用途                                                                                                                                                                                 |
| --------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| KV              | ・グローバル分散型の Key-Value ストア<br>・結果整合性<br>・非常に高速な読み取り、書き込み伝播に最大 60 秒かかる<br>・シンプルな API                                                                                                                             | ・設定情報やフィーチャーフラグのキャッシュ<br>・セッションデータ<br>・即時整合性が不要でグローバル分散と読み取り速度が重要なデータ                                                             |
| Durable Objects | ・強い整合性<br>・各オブジェクトがグローバルで一意の名前<br>・計算とストレージを統合<br>・Free プランではローカル SQLite ストレージ<br>・サーバーレスで自動スケーリング<br>・リアルタイムかつステートフルな連携<br>・現在は無料プランでも利用可能(利用制限あり) | ・リアルタイムのコラボツール(チャット、マルチプレイヤーゲームなど)<br>・ユーザーやルームごとの状態管理<br>・複数クライアント間の調整<br>・強い整合性と低遅延なステートフルロジックが必要な場合 |
| D1              | ・サーバーレスな SQL データベース(SQLite ベース)<br>・SQL クエリ対応<br>・強い整合性<br>・エッジファースト設計<br>・無料<br>・有料プランあり(利用制限付き)                                                                                                      | ・リレーショナルデータ<br>・SQL が必要なアプリ(ブログ、EC、分析など)<br>・結合やフィルタ、トランザクションが必要なワークロード                                                                 |
| R2              | ・S3 互換のオブジェクトストレージ<br>・エグレス料金なし<br>・大容量ファイル(画像、動画、バックアップ等)対応<br>・トランザクションや低遅延 Key-Value 用途には不向き                                                                                              | ・大容量静的アセットの保存<br>・配信<br>・メディアストレージ<br>・バックアップ<br>・S3 互換ツールとの連携                                                                                      |

**使い分けポイント**

- **KV**:グローバル分散と高速な読み取りが必要で、結果整合性で問題ない場合。設定やセッションデータなどに最適
- **Durable Objects**:強い整合性、ステートフルなロジック、クライアント間のリアルタイム連携が必要な場合に。リアルタイムアプリやユーザーごとの状態管理に
- **D1**:SQL クエリやトランザクション、リレーショナルデータの管理が必要な場合
- **R2**:大容量ファイルの保存や配信、S3 互換 API やエグレス無料が重要な場合
